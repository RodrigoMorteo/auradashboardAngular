<div class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden h-full flex flex-col">
  <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
      KPI Trends
    </h3>
    @if (viewMode === 'full') {
      <form [formGroup]="filterForm" class="flex space-x-4 mt-2">
        <label class="flex items-center space-x-1 text-sm text-gray-700 dark:text-gray-300">
          <input type="checkbox" formControlName="q1" class="form-checkbox h-4 w-4 text-indigo-600 rounded">
          <span>Q1</span>
        </label>
        <label class="flex items-center space-x-1 text-sm text-gray-700 dark:text-gray-300">
          <input type="checkbox" formControlName="q2" class="form-checkbox h-4 w-4 text-indigo-600 rounded">
          <span>Q2</span>
        </label>
        <label class="flex items-center space-x-1 text-sm text-gray-700 dark:text-gray-300">
          <input type="checkbox" formControlName="q3" class="form-checkbox h-4 w-4 text-indigo-600 rounded">
          <span>Q3</span>
        </label>
        <label class="flex items-center space-x-1 text-sm text-gray-700 dark:text-gray-300">
          <input type="checkbox" formControlName="q4" class="form-checkbox h-4 w-4 text-indigo-600 rounded">
          <span>Q4</span>
        </label>
      </form>
    }
  </div>

  @if (isLoading()) {
    <div class="flex-grow flex items-center justify-center text-gray-500 dark:text-gray-400">Loading Chart...</div>
  } @else {
    <div class="flex-grow p-4">
      <ngx-charts-line-chart
        role="img"
        aria-label="Line chart showing Key Performance Indicator trends over time."
        [animations]="false"
        [view]="view"
        [scheme]="colorScheme"
        [legend]="legend"
        [showXAxisLabel]="showXAxisLabel"
        [showYAxisLabel]="showYAxisLabel"
        [xAxis]="true"
        [yAxis]="true"
        [xAxisLabel]="xAxisLabel"
        [yAxisLabel]="yAxisLabel"
        [timeline]="timeline"
        [results]="chartData()">
      </ngx-charts-line-chart>
    </div>
  }
</div>